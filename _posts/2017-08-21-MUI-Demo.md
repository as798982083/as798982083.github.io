---
layout:     post
title:      "mui学习笔记"
subtitle:   "mui入门学习笔记"
date:       2017/8/23 21:56:46 
author:     "zcj"
header-img: "img/in-post/post-eleme-pwa/eleme-at-io.jpg"
header-mask: 0.3
catalog:    true
tags:
    - mui
    - JavaScript
---

每个知识点都有示例图片的实现代码。  

# UI组件

## 一、折叠面板

折叠面板示例图：  
![折叠框](/img/mui/accordion.gif)  

最简代码：
{% highlight html %}
<ul class="mui-table-view"> 
    <li class="mui-table-view-cell mui-collapse mui-active">
        <a class="mui-navigate-right" href="#">面板1</a>
        <div class="mui-collapse-content">
            <p>面板1子内容</p>
        </div>
    </li>
    <li class="mui-table-view-cell mui-collapse">
        <a class="mui-navigate-right" href="#">面板2</a>  
        <div class="mui-collapse-content">
            <p>面板2子内容</p>
        </div>
    </li>
</ul>
{% endhighlight %}

`.mui-table-view`和`.mui-table-view-cell`: 必不可少。  
`.mui-collapse`: 表示该选项可折叠(收起来)。  
`.mui-active`: 与`.mui-collase`合用，表示列表默认打开。  
`.mui-navigate-right`: 在最右边显示一个箭头。

## 二、输入框

总共有五种输入框类型，如图：  
![输入框汇总](/img/mui/input3.gif)  

最简代码：
{% highlight html %}
<form class="mui-input-group">
    <div class="mui-input-row mui-search">
		<input type="search" class="mui-input-clear" placeholder="搜索框" />
	</div>
	<div class="mui-input-row">
		<label>input</label>
		<input type="text" class="" placeholder="普通输入框"/>
	</div>
	<div class="mui-input-row">
		<label>input</label>
		<input type="text" class="mui-input-clear" placeholder="带清除按钮的输入框" />
	</div>
	<div class="mui-input-row">
		<label>input</label>
		<input type="text" class="mui-input-speech" placeholder="语音输入" />
	</div>
	<div class="mui-input-row">
		<label>input</label>
		<input type="password" class="mui-input-password" placeholder="密码输入" />
	</div>
</form>
{% endhighlight %}

`.mui-input-group`: input框放在这个class标签下，会有美化的效果。  
`.mui-input-row`： 美化时用来区分input框的每一行。  
`.mui-search`: 与`.mui-input-row`放在同一级，子标签的input属性type使用search，就可以使用搜索框。input的class属性可以用来设置搜索输入框的属性。具体有以下三种（可组合使用）：  
`.mui-input-clear`: 带有清除按钮的输入框。  
`.mui-input-speech`: 带有语音输入按钮的输入框。  
`.mui-input-password`: 与type的password属性一起使用，是带有隐藏密码功能的输入框。  

注：使用`.mui-input-group`可以美化输入框的排列，一下为使用和不使用的区别：  

![美化的输入框](/img/mui/input2.png)
![不美化的输入框汇](/img/mui/input1.png)

## 三、操作表

弹出框示例图：  
![弹出框](/img/mui/actionsheet.gif)  

最简代码：
{% highlight html %}
<div id="sheet1" class="mui-popover mui-popover-action">
    <!-- 可选择菜单 -->
    <ul class="mui-table-view">
      <li class="mui-table-view-cell">
        <a href="#">菜单1</a>
      </li>
      <li class="mui-table-view-cell">
        <a href="#">菜单2</a>
      </li>
    </ul>
    <!-- 取消菜单 -->
    <ul class="mui-table-view">
      <li class="mui-table-view-cell">
        <a href="#sheet1"><b>取消</b></a>
      </li>
    </ul>
</div>
<button type="button" onclick="show();">show</button>
<script type="text/javascript">
	function show () {
		mui('#sheet1').popover('toggle');//控制菜单的显示与隐藏
	}
</script>
{% endhighlight %}

`.mui-popover`: 表明该部分作为弹出框显示。  
`.mui-popover-action`: 弹出框在底部显示，不加该类，则在按钮所在位置显示弹出框。

## 四、数字角标

数字角标示例图：  
![数字角标](/img/mui/badges.png)

最简代码：
{% highlight html %}
<ul class="mui-table-view">
	<li class="mui-table-view-cell">
		item1<span class="mui-badge">1</span>
	</li>
	<li class="mui-table-view-cell">
		item2<span class="mui-badge mui-badge-primary">12</span>
	</li>
	<li class="mui-table-view-cell">
		item3<span class="mui-badge mui-badge-success">123</span>
	</li>
	<li class="mui-table-view-cell">
		item4<span class="mui-badge mui-badge-warning">3</span>
	</li>
	<li class="mui-table-view-cell">
		item5<span class="mui-badge mui-badge-danger">45</span>
	</li>
	<li class="mui-table-view-cell">
		item6<span class="mui-badge mui-badge-purple mui-badge-inverted">456</span>
    </li>
</ul>
{% endhighlight %}

`.mui-badge`:  角标的核心类,默认为实心灰色背景。  
`.mui-badge-primary`: 内置了蓝色（blue）、绿色(green)、黄色(yellow)、红色(red)、紫色(purple)五种色系的数字角标。  
`.mui-badge-inverted`： 隐藏底色，只显示数字的颜色，如上item6。  

## 五、按钮

1.普通按钮
普通按钮示例图：  
![普通按钮](/img/mui/buttons.png)

最简代码：
{% highlight html %}
<button type="button" class="mui-btn">默认</button>
<button type="button" class="mui-btn mui-btn-primary">蓝色</button>
<button type="button" class="mui-btn mui-btn-success">绿色</button>
<button type="button" class="mui-btn mui-btn-warning">黄色</button>
<button type="button" class="mui-btn mui-btn-danger mui-btn-outlined">红色</button>
<button type="button" class="mui-btn mui-btn-royal mui-btn-outlined">紫色</button> 
{% endhighlight %}

`.mui-btn`: 使用该类，即可生成一个默认的按钮。  
`.mui-btn-primary`: 按钮有五种色系蓝、绿、黄、红、紫，对应五种场景`primary`、`success`、`warning`、`danger`、`royal`。  
`.mui-btn-outlined`: 隐藏底色，只显示带颜色的边框和文字。

2.加载中按钮
加载中按钮示例图：  
![加载中按钮](/img/mui/button-loading.gif)

最简代码：
{% highlight html %}
<button id="btn" type="button" 
	data-loading-icon="mui-spinner mui-spinner-	custom" 
	data-loading-text="loading" 
	data-loading-icon-position="left" 
		class="mui-btn mui-btn-primary">确认</button>
<script type="text/javascript">
	mui(document.body).on('tap', '#btn', function(e) {
    mui(this).button('loading');
    setTimeout(function() {
	        mui(this).button('reset');
	    }.bind(this), 2000);
	});
</script>
{% endhighlight %}

`data-loading-icon`: loading 状态显示的icon,默认为`mui-spinner`或`mui-spinner mui-spinner-white`（根据按钮样式自动识别），为空表示不使用icon.  
`data-loading-text`: loading 状态显示的文案,默认为: loading.  
`data-loading-icon-position`: loading 状态显示的icon的位置,支持left/right默认left.  

**JS API**  
DCloud封装的`tap`功能，替代了`onclick`功能。  
`mui(this).button('loading')`: 获取当前MUI标签，改变当前状态为loading。  
`mui(this).button('reset')`: 同上，改变当前状态为初始状态。  
`setTimeout(function(){},2000)`： 延迟2秒执行该函数。  

## 六、卡片式图

卡片式图示例图：  
![卡片式图](/img/mui/cardview.gif)
	
最简代码：
{% highlight html %}
<div class="mui-card">
	<!--页眉，放置标题-->
	<div class="mui-card-header mui-card-media">
		<img src="images/jimitu.gif" />
		<div class="mui-media-body">
			机密兔
			<p>发表于 2018-08-21 23:26</p>
		</div>
	</div>
	<!--内容区-->
	<div class="mui-card-content">
		<img src="images/jimitu.gif" style="height: 100%;width: 100%;"/>
		爱宠大机密里的机密兔，很可爱。
	</div>
	<!--页脚，放置补充信息或支持的操作-->
	<div class="mui-card-footer">
		<button type="button" class="mui-btn mui-btn-primary mui-btn-outlined">喜欢</button>
		<button type="button" class="mui-btn mui-btn-royal mui-btn-outlined">评论</button>
		<button type="button" class="mui-btn mui-btn-danger mui-btn-outlined">不喜欢</button>
	</div>
</div>
{% endhighlight %}

`.mui-card`: 生成一个卡片容器，包括页眉、内容、页脚三部分。  
`.mui-card-header`: 页眉部分，可放置文字+图片。若要放置图片，需加上`.mui-card-media`。  
`.mui-media-body`: 页眉中可自定义的部分，用于放置标题、副标题等自定义的内容。     
`.mui-card-content`: 内容部分，可直接放置文字+图片。
`.mui-card-footer`: 页脚不可添加图片。  

## 七、复选框

复选框示例图：  
![复选框](/img/mui/checkbox.gif)  

最简代码：
{% highlight html %}
<div class="mui-input-group">
	<div class="mui-input-row mui-checkbox">
	  <label>checkbox示例</label>
	  <input type="checkbox" name="checkbox1" value="Item 1" checked>
	</div>
	
	<div class="mui-input-row mui-checkbox mui-left">
	  <label>checkbox左侧显示示例</label>
	  <input type="checkbox" name="checkbox1" value="Item 1">
	</div>
	
	<div class="mui-input-row mui-checkbox">
	  <label>checkbox禁用示例</label>
	  <input type="checkbox" name="checkbox1" value="Item 1" disabled="disabled">
	</div>
</div>
{% endhighlight %}

`.mui-input-group`: 美化`.mui-input-row`所在的标签。  
`.mui-checkbox`: 美化复选框的显示。  
`.mui-left`: 默认的复选框在右侧，加上该类，则在左侧显示。  
`checked`: 默认勾选复选框。  
`disabled="disabled"`: 标签禁用（但可以显示）。

## 八、消息框

消息框示例图：  
![消息框](/img/mui/dialog.gif)  

最简代码：
{% highlight html %}
<button id="alert" class="mui-btn mui-btn-blue mui-btn-outlined">alert</button>
<button id="confirm" class="mui-btn mui-btn-blue mui-btn-outlined">confirm</button>
<button id="prompt" class="mui-btn mui-btn-blue mui-btn-outlined">prompt</button>
<button id="toast" class="mui-btn mui-btn-blue mui-btn-outlined">toast</button>
<br />
<label id="showTest">这里显示回调函数的结果。</label>
<script type="text/javascript">
	mui(document.body).on('tap',"#alert",function(e) {
		mui.alert("alert你一下","titla","按钮文字",function (e) {
		});
	});
	mui(document.body).on('tap',"#confirm",function (e) {
		mui.confirm("Are you boy?","title",['确定','取消'],function (e) {
		});
	});
	mui(document.body).on('tap',"#prompt",function (e) {
		mui.prompt("这是输入对话框","placeholder","title",['确定','取消'],function (e) {
			
		},'div');
	});
	mui(document.body).on('tap',"#toast",function (e) {
		mui.toast('登录成功',{duration:'long',type:'div'});
	});
</script>
{% endhighlight %}

**代码解释 JS API：**  
`mui.alert(message,title,btnValue,callback[,type])`: 参数分别为：对话框内容，对话框标题，按钮上的文字，回调函数，是否使用h5绘制的对话框。  
`mui.confirm(message,title,btnValue,callback[,type])`: 参数同上。  
`mui.prompt(message,placeholder,title,btnValue,callback[,type])`: 参数分别为：对话框内容，提示文字，标题，按钮文字，回调函数，是否使用h5绘制的对话框。  
`.closePopup()`: 关闭最后一次弹出的对话框（仅限h5模式的对话框）。  
`.closePopups()`: 关闭所有对话框（仅限h5模式的对话框）。  
> 带上`mui.`前缀的`alert`等对话框，都是原生的对话框，不加该前缀的为h5模式的对话框。

## 九、图片轮播

图片轮播示例图：  
![图片轮播](/img/mui/gallery.gif)  

最简代码：  
{% highlight html %}
<div class="mui-slider">
	<div class="mui-slider-group mui-slider-loop">
		<div class="mui-slider-item"><a href="#"><img src="images/pets (4).jpg" /></a></div>
		<div class="mui-slider-item"><a href="#"><img src="images/pets (1).jpg" /></a></div>
		<div class="mui-slider-item"><a href="#"><img src="images/pets (2).jpg" /></a></div>
		<div class="mui-slider-item"><a href="#"><img src="images/pets (3).jpg" /></a></div>
		<div class="mui-slider-item"><a href="#"><img src="images/pets (4).jpg" /></a></div>
		<div class="mui-slider-item"><a href="#"><img src="images/pets (1).jpg" /></a></div>
	</div>
</div>
<script type="text/javascript">
	var gallery = mui('.mui-slider');
	gallery.slider({
		interval:100//自动轮播周期，若为0则不自动播放，默认为0；
	});
</script>
{% endhighlight %}

**代码解释：**  
`.mui-slider-group`: 图片轮播容器。  
`.mui-slider-loop`: 与`.mui-slider-group`放在同一级，表示容器内的图片可以循环播放。如果要循环播放，则需要在头尾增加两张重复的图片。  
`.mui-slider-item`: 图片元素。  
**JS API：**  
`mui('.mui-slider').slider({interval:100});`: mui框架内封装的轮播JS API，实现100毫秒轮播间隔。  
> 若轮播组件的内容为js动态加载的（如通过ajax动态加载），则需要在动态加载完组件内容后，手动调用上述JS API，以实现轮播效果。
 
## 十、栅格

官方API有变动，而文档尚未更新。。。

## 十一、图标

[icon官方图标](http://dev.dcloud.net.cn/mui/ui/#icon)

最简代码：  
{% highlight html %}
<span class="mui-icon mui-icon-weixin"></span>
{% endhighlight %}

## 十二、列表

列表示例图：  
![列表](/img/mui/list.gif)  

最简代码：
{% highlight html %}
<ul class="mui-table-view">
    <li class="mui-table-view-cell">
    	<a class="mui-navigate-right">
    		Item 1
    	</a>
    </li>
    <li class="mui-table-view-cell">
    	Item 2
    	<span class="mui-badge mui-badge-danger">9</span>
    </li>
    <li class="mui-table-view-cell">Item 3</li>
</ul>
<ul class="mui-table-view">
	<li class="mui-table-view-cell mui-media">
		<a href="javascript:;">
			<img class="mui-media-object mui-pull-left" src="images/pets (1).jpg"/>
			<div class="mui-media-body">
				幸福
				<p class="mui-ellipsis">回家撸猫~</p>
			</div>
		</a>
	</li>
	<li class="mui-table-view-cell mui-media">
		<a href="javascript:;">
			<img class="mui-media-object mui-pull-right" src="images/pets (2).jpg"/>
			<div class="mui-media-body">
				快乐
				<p class="mui-ellipsis">回家撸狗狗，会不会被咬</p>
			</div>
		</a>
	</li>
</ul>
{% endhighlight %}

**代码解释：**  
`.mui-table-view`: `ul`标签上添加该类，并在`li`标签上添加`.mui-table-view-cell`类，即可实现最简单的列表控件。  
`.mui-navigate-right`: 在`li`标签内添加`a`标签，并使用该类，会在右侧显示小箭头。  
`mui-badge`: mui支持将数字角标(`mui-badge`)、按钮(`mui-btn`)、开关(`mui-switch`)等控件放在列表中，默认放在右侧。  
`mui-media`: 允许放置图文列表，注意该类的同级类。  
`mui-object`: 对象，可以是图片。  
`mui-pull-left`: 设置object的显示位置，默认为左边。  
`mui-media-body`: 主体部分。  
`mui-ellipsis`: 该部分的内容在无法全部显示的情况下会省略。  

## 十三、遮罩蒙版

遮罩蒙版例图（浏览器上显示不了，暂时没有图片）：  

最简代码：  
{% highlight html %}
<button type="button" id="mask" class="mui-btn">显示蒙版</button>
<script type="text/javascript">
	var mask = mui.createMask(callback);//callback为用户点击蒙版时自动执行的回调；
	mui(document.body).on('tap','#mask',function (e) {
		mask.show();//显示遮罩
	});
    mask.close();//关闭遮罩
</script>
{% endhighlight %}

**代码解释 JS API:**  
`mui.createMask()`: 创建蒙版对象。  
`mui.createMask().show()`: 显示蒙版。 
`mui.createMask().close()`: 关闭蒙版。  

## 十三、数字输入框

数字输入框示例图：  
![数字输入框](/img/mui/numbox.gif)

最简代码：
{% highlight html %}
<div class="mui-numbox" data-numbox-step = "10" data-numbox-min = "0" 
	data-numbox-max="100">
  <!-- "-"按钮，点击可减小当前数值 -->
  <button class="mui-btn mui-numbox-btn-minus" type="button">-</button>
  <input class="mui-numbox-input" type="number" />
  <!-- "+"按钮，点击可增大当前数值 -->
  <button class="mui-btn mui-numbox-btn-plus" type="button">+</button>
</div>
{% endhighlight %}

**代码解释：**   
`.mui-numbox`: 数字输入框容器。  
`data-numbox-step`: 每次按钮加减的数值。  
`data-numbox-min`: 显示的最小数值。  
`data-numbox-max`: 显示的最大数值。  
`.mui-numbox-btn-minus`: 数字输入框的`－`按钮。  
`.mui-numbox-input`: 与`number`属性一起使用，生成数字输入框的显示框。  
`.mui-numbox-btn-plus`: 数字输入框的`+`按钮。  

## 十四、侧滑菜单

[侧滑导航官文](http://dev.dcloud.net.cn/mui/ui/#offcanvas)

mui提供两种侧滑导航实现:

1.webview模式,在一个单独的webview中实现菜单。  

优点：  
> 菜单内容是独立的webview，故可被多个页面复用。  
> 菜单独立，因此菜单内容的滚动不影响界面，故可使用原生滚动，更流畅。 
  
缺点：  
> 不支持拖动手势。  
> 主界面和菜单不在同一个webview，交互需要使用自定义事件实现跨越webview通讯。  

2.div模式 
与主页面在同一个webview下，嵌套在特定结构的div中。  
优点：  
> 支持拖动手势。  
> 使用JS轻松实现主页面和菜单的交互。  

缺点：  
> 菜单部分不能再多个页面复用。
> 使用div区域滚动，低端Android机可能会有卡顿现象。  


侧滑菜单示例图DOM1：  
![DOM1](/img/mui/offcanvasDOM1.gif)

最简代码  
**DOM结构1:**
{% highlight html %}
<!-- 侧滑导航根容器 -->
<div class="mui-off-canvas-wrap mui-draggable mui-slide-in">
  <!-- 菜单容器 -->
  <aside class="mui-off-canvas-left">
    <div class="mui-scroll-wrapper">
      <div class="mui-scroll">
        <!-- 菜单具体展示内容 -->
        ...
      </div>
    </div>
  </aside>
  <!-- 主页面容器 -->
  <div class="mui-inner-wrap">
    <!-- 主页面标题 -->
    <header class="mui-bar mui-bar-nav">
      <a class="mui-icon mui-action-menu mui-icon-bars mui-pull-left"></a>
      <h1 class="mui-title">标题</h1>
    </header>
    <div class="mui-content mui-scroll-wrapper">
      <div class="mui-scroll">
        <!-- 主界面具体展示内容 -->
        ...
      </div>
    </div>  
  </div>
</div>
{% endhighlight %}

**代码解释：**  
`mui-off-canvas-wrap`: 侧滑导航的根容器类。  
`mui-draggable`: 默认侧滑动画，主界右移，菜单不动。    
`mui-off-canvas-left`: 在左边的菜单容器。  
`mui-off-canvas-right`： 在右边的菜单容器。  
`mui-scroll-wrapper`: 可以滚动的区域容器。  
`mui-scroll`: 可以滚动的区域。  
`mui-inner-wrap`: 主界面容器。    
**DOM1结构下的动画样式：**  
`mui-scalable`: 缩放式侧滑。  
`mui-slide-in`: 主界面不动，菜单移动。  



侧滑菜单示例图DOM2：    
![DOM2](/img/mui/offcanvasDOM2.gif)

最简代码  
**DOM结构2:**
{% highlight html %}
<!-- 侧滑导航根容器 -->
<div class="mui-off-canvas-wrap mui-draggable">
  <!-- 主页面容器 -->
  <div class="mui-inner-wrap">
     <!-- 菜单容器 -->
    <aside class="mui-off-canvas-left">
      <div class="mui-scroll-wrapper">
        <div class="mui-scroll">
          <!-- 菜单具体展示内容 -->
          ...
        </div>
      </div>
    </aside>
    <!-- 主页面标题 -->
    <header class="mui-bar mui-bar-nav">
      <a class="mui-icon mui-action-menu mui-icon-bars mui-pull-left"></a>
      <h1 class="mui-title">标题</h1>
    </header>
    <!-- 主页面内容容器 -->
    <div class="mui-content mui-scroll-wrapper">
      <div class="mui-scroll">
        <!-- 主界面具体展示内容 -->
        ...
      </div>
    </div>  
  </div>
</div>
{% endhighlight %}

**代码解释：**   
> 两种结构的不同：DOM2结构的主页面容器`mui-inner-wrap`将菜单容器`mui-off-canvas-left`包含在内。  

**mui操作div模式侧滑菜单的方法:**  
1. 在界面上拖动操作（drag）；  
2. 点击含有`mui-action-menu`类的控件；  
3. Android手机按menu键；  
4. 通过JS API触发；  

**JS API:**  
1. `show()`/显示  
2. `close()`/隐藏   
3. `toggle()`/切换  

以上方法均可用以下两种方式调用：  
1. `mui('.mui-off-canvas-wrap').offCanvas('show');`  
2. `mui('.mui-off-canvas-wrap').offCanvas().show();`

**事件监听：**  
可以通过以下方式监听侧滑菜单的显示与隐藏:  
1. `shown `   
2. `hidden`  

监听方法：  
{% highlight javascript %}
document.querySelector('.mui-off-canvas-wrap').addEventListener('shown',function (event) {  
    //...  
})
{% endhighlight %}

或者调用`isShown()`方法判断显示状态:  
{% highlight javascript %}
mui('.mui-off-canvas-wrap').offCanvas().isShown();
{% endhighlight %}

`isShown()`方法也可以传递direction(方向) 参数( 非必选!! )进而可以判断左右侧滑  
{% highlight javascript %}
mui('.mui-off-canvas-wrap').offCanvas().isShown('left');//true
{% endhighlight %}

## 十五、弹出菜单  

弹出菜单示例图：  
![弹出菜单](/img/mui/popover.gif)  

最简代码：  
{% highlight html %}
<a href="#popover" id="openPopover" 
	class="mui-btn mui-btn-primary mui-btn-block">直接打开弹出菜单</a>
<a href="" id="openPopoverJS" 
	class="mui-btn mui-btn-primary mui-btn-block">使用JS打开弹出菜单</a>
...
<div id="popover" class="mui-popover">
  <ul class="mui-table-view">
    <li class="mui-table-view-cell"><a href="#">Item1</a></li>
    <li class="mui-table-view-cell"><a href="#">Item2</a></li>
    <li class="mui-table-view-cell"><a href="#">Item3</a></li>
    <li class="mui-table-view-cell"><a href="#">Item4</a></li>
    <li class="mui-table-view-cell"><a href="#">Item5</a></li>
  </ul>
</div>
<script type="text/javascript">
	mui(document.body).on('tap','#openPopoverJS',function () {
		//会在body层面调用事件，菜单显示在body层上。
		//mui('.mui-popover').popover("toggle");
		//会在#openPopoverJS层面调用事件，菜单会关联到#openPopoverJS层上。
		mui('.mui-popover').popover("toggle",
		document.getElementById('openPopoverJS'));
	});
</script>
{% endhighlight %}

**代码解释：**  
`mui-popover`: 菜单容器，只能放在`div`标签中,菜单内容不限。  
`mui`推荐使用锚点方式显示和隐藏菜单。
{% highlight html %}
<a href="#popover" id="openPopover" class="mui-btn mui-btn-primary mui-btn-block">
    打开弹出菜单
</a>
{% endhighlight %}

也可以通过JS方式控制弹出菜单。  
{% highlight javascript %}
mui('.bottomPopover').popover("toggle",document.getElementById('openPopoverJS'));
{% endhighlight %}

第一个参数可以是以下三个：   
1. `show`   
2. `hide`  
3. `toggle`

第二个参数可设置弹出菜单绑定的锚点。


## 十六、选择器  

[picker官文](http://dev.dcloud.net.cn/mui/ui/#picker)

> 在`mui`中，Picker有两种具体表现：`.poppicker`(普通选择器)和`.dtpicker`(时间选择器)

**Poppicker：**   
特点：支持多级联动。  

单级选择器示例图：  
![单级选择器](/img/mui/poppicker.gif)  

最简代码：
{% highlight html %}
<link rel="stylesheet" type="text/css" href="css/mui.picker.css"/>
<link rel="stylesheet" type="text/css" href="css/mui.poppicker.css"/>
<script src="js/mui.picker.js" type="text/javascript" charset="utf-8"></script>
<script src="js/mui.poppicker.js" type="text/javascript" charset="utf-8"></script>
...
<script type="text/javascript">
	var picker = new mui.PopPicker();
	picker.setData([{
	    value: "first",
	    text: "填充数据后，可设定每个层级的选中项"
	}, {
	    value: "second",
	    text: "instance.pickers[index] 拿到指定层级的实例"
	}, {
	    value: "third",
	    text: "setSelectedIndex()和setSelectedValue()"
	}, {
	    value: "fourth",
	    text: "两个方法可以指定层级中的选中项"
	}, {
	    value: "fifth",
	    text: "代码如下"
	}])
	//picker.pickers[0].setSelectedIndex(4, 2000);
	picker.pickers[0].setSelectedValue('fourth', 2000);
	picker.show(function (selectItems) {
	    console.log(selectItems[0].value);//zz 
	    console.log(selectItems[0].text);//智子
		//return false; //可以阻止选项框的关闭
	});
	//picker.hide();//隐藏picker
	//picker.dispose(); //释放组件资源，下次使用需要再次创建实例。
</script>
{% endhighlight %}

**代码解释：**  
> 以下使用到的`.js/.css`文件，可以在HBuilder中新建一个Hello mui示例项目，项目中包含所有使用到的`.js/.css`文件。  

1. `mui.picker.js/.css mui.poppicker.js/.css`：`.poppicker`的依赖组件，务必在`mui.js/css`后引用,也可统一引用压缩版本`mui.picker.min.js`。  
2. `new PopPicker()`: 初始化poppicker组件。  
3. `setData()`： 添加数据，格式为数组。  
4. `instance.pickers[index]`: `instance`为创建的组件实例，`index`从0开始算起。  
5. `seSelectedIndex(index,duration,callback)`: `index`从0开始算起，`duration`动画持续时长，`callback`成功后的回调函数。  
6. `instance.show(getSelectedItems)`: 显示选择器。  
7. `return false;`: 在回调函数中使用，可以阻止选项框的关闭。  
8. `instance.hide()`: 隐藏`instance`。  
9. `instance.dispose()`: 释放组件资源，下次在使用必须要再次创建实例。   


多级选择器示例图：  
![多级选择器](/img/mui/poppicker2.gif)  

最简代码：  
{% highlight html %}
<script type="text/javascript">
	var picker = new mui.PopPicker({
	    layer: 2
	});
    picker.setData([{
        value: '110000',
        text: '北京市',
        children: [{
                value: "110101",
                text: "东城区"
        }]
    }, {
        value: '120000',
        text: '天津市',
        children: [{
	        value: "120101",
            text: "和平区"
        }, {
            value: "120102",
            text: "河东区"
        }, {
            value: "120104",
            text: "南开区"
        }
        ]
    }]);
    //以此获取每一层级的对象，并设置默认值。
	picker.pickers[0].setSelectedIndex(1,100);//参数index,duration,callback
	picker.pickers[1].setSelectedIndex(2,1000);
	picker.show(function(SelectedItem) {
		console.log(SelectedItem[0].value);
		console.log(SelectedItem[0].text);
	})；
</script>
{% endhighlight %}

**代码解释：**  
多级联动只要修改`setData()`中的数组参数即可。


**dtpicker:**  
dtpicker组件适用于弹出日期选择器。  

时间选择器示例图：  
![时间选择器](/img/mui/dtpicker2.gif)  

最简代码：  
{% highlight html %}
<link rel="stylesheet" type="text/css" href="css/mui.dtpicker.css"/>
<script src="js/mui.dtpicker.js" type="text/javascript" charset="utf-8"></script>
...
<script type="text/javascript">
	var dtpicker = new mui.DtPicker({
	    type: "datetime",//设置日历初始视图模式 
	    beginDate: new Date(2015, 04, 25),//设置开始日期 
	    endDate: new Date(2016, 04, 25),//设置结束日期 
	    labels: ['Year', 'Mon', 'Day', 'Hour', 'min'],//设置默认标签区域提示语 
	    customData: { 
	        h: [
	            { value: 'AM', text: 'AM' },
	            { value: 'PM', text: 'PM' }
	        ] 
	    }//时间/日期别名 
	}) 
	dtpicker.show(function(e) {
	    console.log(e);
		//return false; //阻止选窗口关闭
	});
		//dtpicker.hide(); //隐藏窗口
		//dtpicker.dispose(); //释放组件资源
</script>
{% endhighlight %}

**代码解释：**    
1. 要是用dtpicker需要先添加`mui.dtpicker.css`和`mui.dtpicker.js`。    
2. `new Dtpicker({options})`: `options`有五个参数，如下：  
3. `type`：可选择`datetime`,`date`,`time`,`month`,`hour`五种类型视图。  
4. `customData`：放一个`json`数组，可选值为:y,m,d,h,i，内容即为显示的内容。  
5. `labels`：设置显示在顶部的字段。    
6. `beginDate`，`endDate`：开始和结束的日期，用于确定显示的时间范围。  
7. `getSelected()`:返回选中的日期字符串，例如"2015-05-25 AM:00"。  
8. `show(getSelected)`:该函数将时间选择器显示出来，参数中可以有一个返回函数。  


## 十七、进度条

准确进度进度条示例图：  
![进度条](/img/mui/progressbar.gif)  

最简代码：  
{% highlight html %}
<div id="demoPro" class="mui-progressbar">
	<span id="">我是进度条</span>
</div>
<script type="text/javascript">
	var progress = mui('#demoPro').progressbar(); //自动检测该节点及直接子节点是否含有mui-progressbar类，没有则自动创建
	progress.show(); 
		//mui('#demoPro').progressbar({progress:20}).show();
	setTimeout(function () {
		progress.setProgress(50);
		console.log(progress);
	},1000);
	progress.hide(); //仅对动态创建的DOM节点有用。
</script>
{% endhighlight %}

**代码解释：**  
1. `mui（'#demoPro').progressbar({progress:20})`: 该函数会自动检测`#demoPro`节点及其直接孩子节点中，是否有`mui-progressbar`这个类，如果有，则以那个控件为容器，显示进度条。如果没有，则自动创建进度条，此时的进度条属于动态创建的。其中的参数把进度设置为20%。    
2. `show()`: 显示进度条。  
3. `setProgress(50)`:设置进度。  
4. `mui-progressbar-infinite`:默认生成的是有准确进度的进度条，在`mui-progressbar`控件中加入该类，则生成一个无限循环的进度条。

无限循环进度条示例图:  
![进度条](/img/mui/progressbar2.gif)  
	
## 十八、透明标题栏

> 当用户向下滚动时，标题栏逐渐由透明转变为不透明；当用户再次向上滚动时，标题栏又从不透明变为透明状态。

进度条示例图：  
![进度条](/img/mui/transparentBar.gif)  

最简代码：
{% highlight html %}
<header class="mui-bar mui-bar-nav mui-bar-transparent" 
	data-top='0' data-offset='150' data-duration='16' 
	data-scrollby=".mui-scroll-wrapper">
	<h1 class="mui-title">标题</h1>
</header>
<div class="mui-content">
	<ul class="mui-table-view">
		<li class="mui-table-view-cell">
			item
		</li>
		
	</ul>		
</div>
<script type="text/javascript">
	mui('.mui-bar-transparent').transparent({
    top: 0,
    offset: 150,
    duration: 16,
    scrollby: document.querySelector('.mui-scroll-wrapper')
})
</script>
{% endhighlight %}

**代码解释：**  
1. `mui-bar-transparent`: 只要在`header`组件上添加该类即可实现透明标题栏。  
2. `data-top`:距离顶部高度（滚动到该位置即触发），JS API:`{top:0}`。  
3. `data-offset`:滚动透明距离，JS API:`{offset:150}`。  
4. `data-duration`:过渡时间ms，JS API:`{duration:16}`。  
5. `data-scrollby`：监听区域滚动容器，默认是`window`，即监听原生滚动。如监听`mui scroll`控件滚动，则使用`.mui-scroll-wrapper`。JS API：`{document.querySelector('.mui-scroll-wrapper')`。

## 十九、单选框

进度条示例图：  
![进度条](/img/mui/radio.gif)  

DOM结构： 
{% highlight html %}
<div class="mui-input-row mui-radio">
	<label>单选</label>
	<input type="radio" name="radio" value="单选" />
</div>
{% endhighlight %}

示例代码：
{% highlight html %}
<div class="mui-input-row mui-radio">
	<label>单选右边</label>
	<input type="radio" name="radio" value="单选右边" />
</div>
<div class="mui-input-row mui-radio mui-left">
	<label>单选左边</label>
	<input type="radio" name="radio" value="单选左边" />
</div>
<div class="mui-input-row mui-radio mui-disabled">
	<label>单选禁用</label>
	<input type="radio" name="radio" value="单选禁用" disabled="disabled"/>
</div>
<ul class="mui-table-view mui-table-view-radio">
	<li class="mui-table-view-cell">
		<a class="mui-navigate-right">
			提供了列表式单选实现 Item1
		</a>
	</li>
	<li class="mui-table-view-cell mui-selected">
		<a class="mui-navigate-right">
			提供了列表式单选实现 Item 2
		</a>
	</li>
	<li class="mui-table-view-cell">
		<a class="mui-navigate-right">
			提供了列表式单选实现 Item 3
		</a>
	</li>
</ul>
<script type="text/javascript">
	var list = document.querySelector('.mui-table-view.mui-table-view-radio');
	list.addEventListener('selected',function(e){
		console.log("当前选中的为："+e.detail.el.innerText);
	});
</script>
{% endhighlight %}

**代码解释：**  
1. `mui-left`: 单选框显示在左边。默认的话显示在右边。  
2. `mui-disabled`+`disabled="disabled"`: 禁用的单选按钮。  
3. `mui-table-view-radio`：在列表控件的根节点上增加该类，可实现列表是单选功能。  
4. `mui-selected`: 默认选中项。  

**JS API:**  
1. 列表在切换选中项时，会触发selected事件。  
2. 事件参数`e.detail.el`可以获得当前选中的节点。  

## 二十、滑块

滑块示例图：  
![滑块](/img/mui/range.gif)  

示例代码：
{% highlight html %}
<div class="mui-input-row mui-input-range">
	<label>Range</label>
	<input id="demoRange" type="range" min="0" max="100">
</div>
<label id="res">显示结果</label>
<script type="text/javascript">
	mui(document.body).on('change','#demoRange',function (e) {
		document.getElementById("res").innerText = this.value;
		console.log(this.value);
		console.log(document.getElementById("res").innerText);
	});
</script>
{% endhighlight %}

**代码解释：**  
1. 基础的DOM结构即上面的`div`控件。  
2. JS 调用也是最基本的JS用法。  
3. `document.getElementById("res").innerText`:获取`label`标签的内容不同于其他标签，需使用`innerText`属性。

## 二十一、区域滚动

div区域滚动的需求是普遍存在的，但系统默认实现又有如下问题：
> Android平台4.0以下不支持div滚动  
> Android平台4.0以上支持div滚动，但不显示滚动条  
> 弹出层的div滚动在iOS平台存在事件透传的问题

因此，mui额外提供了区域滚动组件，使用时需要遵循如下DOM结构

区域滚动示例图：  
![区域滚动](/img/mui/scroll.gif)  

示例代码：
{% highlight html %}
<div class="mui-scroll-wrapper">
	<div class="mui-scroll">
		<ul id="scrollUL" class="mui-table-view"></ul>
	</div>
</div>
<script type="text/javascript">
	//动态创建li标签
	//获取父控件
	var ul = document.getElementById('scrollUL');
	for(var i=1;i<=20;i++){
		//创建li控件
		var li = document.createElement('li');
		//设置显示内容
		li.innerHTML = 'item' + i;
		//设置class属性
		li.setAttribute('class','mui-table-view-cell');
		//添加到父控件中
		ul.appendChild(li); 
	}
	
	mui('.mui-scroll-wrapper').scroll({
		startY: -50,
		deceleration: 0.0006 //flick 减速系数，系数越大，滚动速度越慢，滚动距离越小，默认值0.0006
	});
	setTimeout(function () {
		mui('.mui-scroll-wrapper').scroll().scrollTo(0,0,2000);//100毫秒滚动到顶
	},1000);
	setTimeout(function () {
		mui('.mui-scroll-wrapper').scroll().scrollToBottom(2000);//100毫秒滚动到顶
	},2000);
</script>
{% endhighlight %}

**代码解释：**  
区域滚动组件默认为`absolute`定位，全屏显示；在实际使用过程中，需要手动设置滚动区域的位置（`top`和`height`），常用的配置项：  
> scroll.options  
{% highlight javascript %}
options = {  
	scrollY: true, //是否竖向滚动  
	scrollX: false, //是否横向滚动  
	startX: 0, //初始化时滚动至x  
	startY: 0, //初始化时滚动至y  
	indicators: true, //是否显示滚动条  
	deceleration:0.0006, //阻尼系数,系数越小滑动越灵敏  
	bounce: true //是否启用回弹  
}
{% endhighlight %}

1. `mui('.mui-scroll-wrapper').scroll({})`:初始化`scroll`控件，若使用区域滚动组件，需手动初始化scroll控件。  
2. `scrollTo(0,0,2000)`: 滚动到指定位置，参数依次为：x坐标，y坐标，滚动过程的时长。  
3. `scrollToBottom(2000)`: 滚动到控件底部，参数为滚动过程的时长。  

横向滚动DOM:
{% highlight html %}
<div class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
    <div class="mui-scroll">
        <a class="mui-control-item mui-active">推荐</a>        
        <a class="mui-control-item">热点</a>
        <a class="mui-control-item">北京</a>
        <a class="mui-control-item">社会</a>
        <a class="mui-control-item">娱乐</a>
        <a class="mui-control-item">科技</a>
    </div>
</div>
{% endhighlight %}

横向滚动示例图：  
![区域滚动](/img/mui/scrollX.gif)  

## 二十二、轮播组件

轮播组件示例图：  
![轮播组件](/img/mui/slide.gif)  

DOM结构：
{% highlight html %}
<div class="mui-slider">
  <div class="mui-slider-group">
    <!--第一个内容区容器-->
    <div class="mui-slider-item">
      <!-- 具体内容 -->
    </div>
    <!--第二个内容区-->
    <div class="mui-slider-item">
      <!-- 具体内容 -->
    </div>
  </div>
</div>
{% endhighlight %}

示例代码：
{% highlight html %}
<div class="mui-slider">
  <div class="mui-slider-group">
    <div id="item1" class="mui-slider-item">
      <img src="images/jimitu.gif" />
    </div>
    <div id="item2" class="mui-slider-item">
      <img src="images/pets (1).jpg" />
    </div>
  </div>
</div>
<label id="label">显示结果</label>
<script type="text/javascript">
	document.querySelector('.mui-slider')
	.addEventListener('slide', function(event) {
	  if (event.detail.slideNumber === 0) {
	    console.log("已经切换到第一项");
	    var text = "你正在看第"+(event.detail.slideNumber+1)+"张图片";
	    document.getElementById("label").innerText = text;
	  }
	  if (event.detail.slideNumber === 1) {
	    console.log("已经切换到第二项");
	    var text = "你正在看第"+(event.detail.slideNumber+1)+"张图片";
	    document.getElementById("label").innerText = text;
	  }
	});
</script>
{% endhighlight %}

**JS API：**  
1. 监听轮播组件的`slide`事件，当选项卡切换时会触发该事件。  
2. `detail.slideNumber`: 当前选项卡的索引，从0开始。  

## 二十三、开关

轮播组件示例图：  
![轮播组件](/img/mui/switch.gif)  

DOM结构：
{% highlight html %}
<div class="mui-switch">
  <div class="mui-switch-handle"></div>
</div>
{% endhighlight %}

示例代码：
{% highlight html %}
<div class="mui-switch">
  	<div class="mui-switch-handle"></div>
</div>
<div class="mui-switch mui-active">
  	<div class="mui-switch-handle"></div>
</div>
<!-- 简洁模式开关关闭状态 -->
<div class="mui-switch mui-switch-mini">
	<div class="mui-switch-handle"></div>
</div>
<!-- 简洁模式开关打开状态 -->
<div class="mui-switch mui-switch-mini mui-active">
  	<div class="mui-switch-handle"></div>
</div>
<!-- 蓝色开关关闭状态 -->
<div class="mui-switch mui-switch-blue mui-switch-mini">
  	<div class="mui-switch-handle"></div>
</div>
<!-- 蓝色开关打开状态 -->
<div id="mySwitch" class="mui-switch mui-switch-blue mui-active">
  	<div class="mui-switch-handle"></div>
</div>
<script type="text/javascript">
	var isActive = document.getElementById("mySwitch").classList.contains("mui-active");
	if(isActive){
	  console.log("打开状态");
	}else{
	  console.log("关闭状态");  
	}
		//mui('#mySwitch').switch().toggle();//官网给出的该方法，已经不能使用 2017.9.6
	document.getElementById("mySwitch")
	.addEventListener("toggle",function(event){
	  if(event.detail.isActive){
	    console.log("你启动了开关");
	  }else{
	    console.log("你关闭了开关");  
	  }
	})
</script>
{% endhighlight %}

**代码解释：**  
1. `mui-switch`和`mui-switch-handle`:是快关的基类。  
2. `mui-active`: 在`mui-switch`节点上增加该类，表示默认打开状态。  
3. `mui-switch-mini`:开关上默认会显示on/off字样，加上该类则不显示文字。  
4. `mui-switch-blue`:在`mui-switch`节点上增加该类，生成蓝色开关控件。  

**注意**  
mui在mui.init()中会自动初始化基本控件,但是 动态添加的 Switch 组件需要手动初始化。  
> `mui('.mui-switch')['switch']()`


# 窗口管理

## 一、页面初始化  
{% highlight javascript %}
mui.plusReady(function(){
 console.log("当前页面URL："+plus.webview.currentWebview().getURL());
});
{% endhighlight %}

1. `mui.plusReady()`:若要使用HTML5+扩展API，必须等到该事件发生后才能正常使用。  
2. `mui.init()`:mui插件初始化。  
3. `mui.ready()`:当DOM准备就绪时，指定一个函数来执行。

## 二、创建子页面    

可在主页面的`mui-init()`方法中初始化子页面，格式如下：
{% highlight javascript %}
mui.init({
subpages:[{
  url:your-subpage-url,//子页面HTML地址，支持本地地址和网络地址
  id:your-subpage-id,//子页面标志
  styles:{
    top:subpage-top-position,//子页面顶部位置
    bottom:subpage-bottom-position,//子页面底部位置
    width:subpage-width,//子页面宽度，默认为100%
    height:subpage-height,//子页面高度，默认为100%
    ......
  },
  extras:{}//额外扩展参数
}]
});
{% endhighlight %}

实例代码：  
{% highlight javascript %}
mui.init({
    subpages:[{
      url:'list.html',
      id:'list.html',
      styles:{
        top:'45px',//mui标题栏默认高度为45px；
        bottom:'0px'//默认为0px，可不定义；
      }
    }]
});
{% endhighlight %}

## 三、打开新页面  
`mui`打开新页面的思路：  
> 单webview只承载单个页面的dom，减少dom层级及页面大小；页面切换使用原生动画，将最耗性能的部分交给原生实现。

格式如下：  
{% highlight javascript %}  
mui.openWindow({
    url:new-page-url,
    id:new-page-id,
    styles:{
      top:newpage-top-position,//新页面顶部位置
      bottom:newage-bottom-position,//新页面底部位置
      width:newpage-width,//新页面宽度，默认为100%
      height:newpage-height,//新页面高度，默认为100%
      ......
    },
    extras:{
      .....//自定义扩展参数，可以用来处理页面间传值
    },
    createNew:false,//是否重复创建同样id的webview，默认为false:不重复创建，直接显示
    show:{
      autoShow:true,//页面loaded事件发生后自动显示，默认为true
      aniShow:animationType,//页面显示动画，默认为”slide-in-right“；
      duration:animationTime,//页面动画持续时间，Android平台默认100毫秒，iOS平台默认200毫秒；
      event:'titleUpdate',//页面显示时机，默认为titleUpdate事件时显示
      extras:{}//窗口动画是否使用图片加速
    },
    waiting:{
      autoShow:true,//自动显示等待框，默认为true
      title:'正在加载...',//等待对话框上显示的提示内容
      options:{
        width:waiting-dialog-widht,//等待框背景区域宽度，默认根据内容自动计算合适宽度
        height:waiting-dialog-height,//等待框背景区域高度，默认根据内容自动计算合适高度
        ......
      }
    }
})
{% endhighlight %}

实例代码：

{% highlight javascript %}  
//tap为mui封装的单击事件，可参考手势事件章节
document.getElementById('info').addEventListener('tap', function() {
  //打开关于页面
  mui.openWindow({
    url: 'examples/info.html', 
    id:'info'
  });
});
{% endhighlight %}


示例2：新打开的页面需要时间下载内容，会出现空白的等待时间，用户体验不好；可通过如下方式改善用户体验（最好的用户体验应该是通过预加载的方式）： 
> 第一步，B页面loaded事件发生后，不自动显示；  

{% highlight javascript %}  
//A页面中打开B页面，设置show的autoShow为false，则B页面在其loaded事件发生后，不会自动显示；
mui.openWindow({
    url: 'B.html', 
    show:{
      autoShow:false
    }
});
{% endhighlight %}
> 第二步，在B页面获取列表数据后，再关闭等待框、显示B页面

{% highlight javascript %}  
//B页面onload从服务器获取列表数据；
window.onload = function(){
  //从服务器获取数据
  ....
  //业务数据获取完毕，并已插入当前页面DOM；
  //注意：若为ajax请求，则需将如下代码放在处理完ajax响应数据之后；
  mui.plusReady(function(){
    //关闭等待框
    plus.nativeUI.closeWaiting();
    //显示当前页面
    mui.currentWebview.show();
  });
}
{% endhighlight %}

## 四、打开带原生导航栏的新页面  

{% highlight javascript %}  
<script type="text/javascript">
	mui.openWindowWithTitle({WebviewOptions},{
	    id:"title",//导航栏ID,默认为title,若不指定将会使用WebviewOptions中指定的 [webviewID+ "_title"] 作为id
	    height:"44px",//导航栏高度值
	    backgroundColor:"#f7f7f7",//导航栏背景色
	    bottomBorderColor:"#cccccc",//底部边线颜色
	    title:{//标题配置
	        text:"",//标题文字
	        position:{ //绘制文本的目标区域，参考：http://www.html5plus.org/doc/zh_cn/nativeobj.html#plus.nativeObj.Rect
	            top:0,
	            left:0,
	            width:"100%",
	            height:"100%"
	        },
	        styles:{//绘制文本样式，参考：http://www.html5plus.org/doc/zh_cn/nativeobj.html#plus.nativeObj.TextStyles
	            color:"#000000",
	            align:"center",
	            family:"'Helvetica Neue',Helvetica,sans-serif",
	            size:"17px",
	            style:"normal",
	            weight:"normal",
	            fontSrc:""
	        }
	    },
	    back:{//左上角返回箭头
	        image:{//图片格式
	            base64Data:'',//加载图片的Base64编码格式数据 base64Data 和 imgSRC 必须指定一个.否则不显示返回箭头
	            imgSrc:'',//要加载的图片路径
	            sprite:{//图片源的绘制区域，参考：http://www.html5plus.org/doc/zh_cn/nativeobj.html#plus.nativeObj.Rect
	                top:'0px',
	                left:'0px',
	                width:'100%',
	                height:'100%'
	            },
	            position:{//绘制图片的目标区域，参考：http://www.html5plus.org/doc/zh_cn/nativeobj.html#plus.nativeObj.Rect
	                top:"10px",
	                left:"10px",
	                width:"24px",
	                height:"24px"
	            }
	        },
	        click:function(){
	            //重写 点击返回图标时执行的回调函数，默认执行mui.back();
	        }
	    }
	})
</script>
{% endhighlight %}

**代码解释：**  
1. `WebviewOptions`:打开新页面时的页面参数，在此设置url即可。  


## 五、关闭页面  

mui框架将窗口关闭功能封装在mui.back方法中，具体执行逻辑是：  
1. 若当前webview为预加载页面，则hide当前webview；  
2. 否则，close当前webview；  

在mui框架中，有三种操作会触发页面关闭（执行`mui.back`方法）：  
1. 点击包含`.mui-action-back`类的控件  
2. 在屏幕内，向右快速滑动  
3. Android手机按下back按键  
4. 直接调用`mui.back`

右滑关闭功能，默认未启用，需要在`mui.init()`;方法中设置`swipeBack`参数来启用：  
{% highlight javascript %}
mui.init({
	swipeBack:true //启用右滑关闭功能
});  
{% endhighlight %}

mui框架默认会监听Android手机的back按键，然后执行页面关闭逻辑； 若不希望mui自动处理back按键，可通过如下方式关闭mui的back按键监听；  
{% highlight javascript %}
mui.init({
	keyEventBind: {
		backbutton: false  //关闭back按键监听
	}
});
{% endhighlight %}

若在关闭窗口之前还要进行其他操作，可在`mui-init()`中设置`beforeback`参数：  
{% highlight javascript %}
mui.init({
	beforeback: function(){
		//获得列表界面的webview
		var list = plus.webview.getWebviewById('list');
		//触发列表界面的自定义事件（refresh）,从而进行数据刷新
		mui.fire(list,'refresh');
		//返回true，继续页面关闭逻辑
		return true;
	}
});
{% endhighlight %}  

`beforeback`的执行逻辑为：  
1. 执行beforeback参数对应的函数若返回false，则不再执行mui.back()方法；  
2. 否则（返回true或无返回值），继续执行mui.back()方法；  

注意：beforeback的执行返回必须是同步的（阻塞模式），若使用nativeUI这种异步js（非阻塞模式），则可能会出现意想不到的结果；比如：通过plus.nativeUI.confirm()弹出确认框，可能用户尚未选择，页面已经返回了（beforeback同步执行完毕，无返回值，继续执行mui.back()方法，nativeUI不会阻塞js进程）：在这种情况下，若要自定义业务逻辑，就需要复写mui.back方法了；如下为一个自定义示例，每次都需要用户确认后，才会关闭当前页面。  

{% highlight javascript %}
//备份mui.back，mui.back已将窗口关闭逻辑封装的比较完善（预加载及父子窗口），因此最好复用mui.back
var old_back = mui.back;
mui.back = function(){
  var btn = ["确定","取消"];
  mui.confirm('确认关闭当前窗口？','Hello MUI',btn,function(e){
    if(e.index==0){
    	//执行mui封装好的窗口关闭逻辑；
    	old_back();
    }
  });
}
{% endhighlight %}  

## 六、预加载  

mui提供两种方式实现页面预加载。
  
方法一：通过mui.init方法中的preloadPages参数进行配置.  

{% highlight javascript %}
mui.init({
  preloadPages:[
    {
      url:prelaod-page-url,
      id:preload-page-id,
      styles:{},//窗口参数
      extras:{},//自定义扩展参数
      subpages:[{},{}]//预加载页面的子页面
    }
  ],
  preloadLimit:5//预加载窗口数量限制(一旦超出,先进先出)默认不限制
});
var list = plus.webview.getWebviewByid('list');//这里可能返回空；
{% endhighlight %}  

**代码解释：**  
1. 通过`plus.webview.getWebviewById`方式可以获得webview的引用，但因为`mui-init()`是异步的，可能会出现获取失败的情况。

方式二：通过mui.preload方法预加载.  

{% highlight javascript %}
var page = mui.preload({
    url:new-page-url,
    id:new-page-id,//默认使用当前页面的url作为id
    styles:{},//窗口参数
    extras:{}//自定义扩展参数
});
{% endhighlight %}  

**代码解释：**  
1. 通过mui.preload()方法预加载，可立即返回对应webview的引用，但一次仅能预加载一个页面；若需加载多个webview，则需多次调用mui.preload()方法；

判断是否预加载成功：

{% highlight javascript %}
mui.plusReady(function(){
	setTimeout(function(){
		var array = plus.webview.all();
		if(array){
			for(var i=0,len=array.length;i<len;i++){
			    	console.log(array[i].getURL());
		        }
		}
	},5000)
});
{% endhighlight %}  

**代码解释：**  
1. 在主页面完全加载（可通过setTimeout模拟）后，打印当前应用所有webview，看是否包含B页面的url，以此来分析。

# 事件管理

## 一、事件绑定  

两种事件绑定方法：

方法一：`addEventListener()`  

{% highlight javascript %}
document.querySelector('.mui-off-canvas-wrap').addEventListener('shown',function (event) {  
    //...  
})
{% endhighlight %}  

**代码解释：**  
1. 该方法只能只能监听某个特定元素上的事件。  

方法二：`.on()`  

{% highlight javascript %}
mui(".mui-table-view").on('tap','.mui-table-view-cell',function(){
  //获取id
  var id = this.getAttribute("id");
  //传值给详情页面，通知加载新数据
  mui.fire(detail,'getDetail',{id:id});
  //打开新闻详情
  mui.openWindow({
    id:'detail',
    url:'detail.html'
  });
}) 
{% endhighlight %}  

**代码解释：**  
1. 该方法可以实现批量元素的事件绑定。  
2. `.on(event,selector,handler)`：三个参数分别为：事件名称（String），选择器（String），事件触发时的回调函数（Function(Event event)）。通过回调中的`event`参数可以获得事件详情。  

## 二、事件取消  

使用`.on()`方法绑定的事件，可以通过`.off()`方法取消绑定。`.off()`方法根据传入参数不同，有不同的实现逻辑。  

> 逻辑一：适用于取消对应选择器上特定事件所执行的特定回调，此处的函数不支持匿名函数。    

`.off(event,selector,handler)`  

{% highlight javascript %}
//点击li时，执行foo_1函数
mui("#list").on("tap","li",foo_1);
//点击li时，执行foo_2函数
mui("#list").on("tap","li",foo_2);

function foo_1(){
  console.log("foo_1 execute");
}

function foo_2(){
  console.log("foo_2 execute");
}
//点击li时，不再执行foo_1函数，但会继续执行foo_2函数
mui("#list").off("tap","li",foo_1);
{% endhighlight %}  

> 逻辑二：适用于取消对应选择器上特定事件的所有回调。  

`.off(event,selector)`  

{% highlight javascript %}
//点击li时，执行foo_1函数
mui("#list").on("tap","li",foo_1);
//点击li时，执行foo_2函数
mui("#list").on("tap","li",foo_2);

function foo_1(){
  console.log("foo_1 execute");
}

function foo_2(){
  console.log("foo_2 execute");
}
//点击li时，foo_2、foo_2两个函数均不再执行
mui("#list").off("tap","li");
{% endhighlight %}  

> 逻辑三：适用于取消当前元素上绑定的特定事件的所有回调。

`.off(event)`  

{% highlight javascript %}
//点击li时，执行foo_1函数
mui("#list").on("tap","li",foo_1);
//点击p时，执行foo_3函数
mui("#list").on("tap","p",foo_3);

function foo_1(){
  console.log("foo_1 execute");
}

function foo_3(){
  console.log("foo_3 execute");
}
//点击li时，不再执行foo_1函数；点击p时，也不再执行foo_3函数
mui("#list").off("tap");
{% endhighlight %}  

> 逻辑四：空参数，删除该元素上所有事件。

`.off()`  

{% highlight javascript %}
//点击li时，执行foo_1函数
mui("#list").on("tap","li",foo_1);
//双击li时，执行foo_4函数
mui("#list").on("doubletap","li",foo_4);
//点击p时，执行foo_3函数
mui("#list").on("tap","p",foo_3);

function foo_1(){
  console.log("foo_1 execute");
}

function foo_3(){
  console.log("foo_3 execute");
}

function foo_4(){
  console.log("foo_4 execute");
}
//点击li时，不再执行foo_1函数；点击p时，也不再执行foo_3函数；双击li时，也不再执行foo_4函数；
mui("#list").off();
{% endhighlight %}  

## 三、事件触发  

`mui.trigger(element,event,data)`：动态触发特定DOM元素上的事件。参数依次为：触发事件的DOM元素（Element)，事件名称(String)例如'`tap`'，需要传递给事件的参数（Object)。  

示例：

{% highlight javascript %}
var btn = document.getElementById("submit");
//监听点击事件
btn.addEventListener("tap",function () {
  console.log("tap event trigger");
});
//触发submit按钮的点击事件
mui.trigger(btn,'tap');  
{% endhighlight %}  

> 部分mui控件监听的事件无法通过`mui.trigger`触发
> 比如无法实现自动触发mui返回图标，实现关闭当前页面的功能，该部分逻辑正在优化中

## 四、手势事件

mui内置了常用的手势事件：  

1. `tap`:单击屏幕。  
2. `doubletap`:双击屏幕。  
3. `longtap`:长按屏幕。  
4. `hold`:按住屏幕。 
5. `release`:离开屏幕。  
6. `swipeleft`:向左滑动。  
7. `swiperight`:向右滑动。  
8. `swipeup`:向上滑动。  
9. `swipedown`:向下滑动。  
10. `dragstart`:开始拖动。  
11. `drag`:拖动中。  
12. `dragend`:拖动结束。  

mui默认会监听部分手势事件，另通过`mui.init`方法中的`gestureConfig`参数，可定义配置具体需要监听的手势事件。

{% highlight javascript %}
mui.init({
  gestureConfig:{
   tap: true, //默认为true
   doubletap: true, //默认为false
   longtap: true, //默认为false
   swipe: true, //默认为true
   drag: true, //默认为true
   hold:false,//默认为false，不监听
   release:false//默认为false，不监听
  }
}); 
{% endhighlight %}  

> 注意:dragstart、drag、dragend共用drag开关，swipeleft、swiperight、swipeup、swipedown共用swipe开关。  

事件监听示例：  

{% highlight javascript %}
elem.addEventListener("swipeleft",function(){
     console.log("你正在向左滑动");
});
{% endhighlight %}  

> 若多个元素执行相同逻辑，则建议使用事件绑定(on())。

## 五、自定义事件  

自定义事件主要用来进行页面间传值。Html5Plus中的evalJS方法仅接收字符串参数，涉及多个参数时，需要开发人员手动拼字符串；mui框架在evalJS方法的基础上，封装了自定义事件，可以实现多webview间数据传递。

添加自定义事件监听操作和标准js事件监听类似，可直接通过window对象添加，如下：  

{% highlight javascript %}
window.addEventListener('customEvent',function(event){
  //通过event.detail可获得传递过来的参数内容
  ....
});
{% endhighlight %}  

通过`mui.fire(target,event,data)`方法可触发目标窗口的自定义事件：  

> **目标webview必须触发loaded事件后才能使用自定义事件**  
> 若新创建一个webview，不等该webview的loaded事件发生，就立即使用webview.evalJS()或mui.fire(webview,'eventName',{})，则可能无效；

假设如下场景：从新闻列表页面进入新闻详情页面，新闻详情页面为共用页面，通过传递新闻ID通知详情页面需要显示具体哪个新闻，详情页面再动态向服务器请求数据，mui要实现类似需求可通过如下步骤实现：

- 在列表页面中预加载详情页面（假设为detail.html）
- 列表页面在点击新闻标题时，首先，获得该新闻id，触发详情页面的newsId事件，并将新闻id作为事件参数传递过去；然后再打开详情页面；
- 详情页面监听newsId自定义事件  

列表页面代码如下：

{% highlight javascript %}
//初始化预加载详情页面
mui.init({
  preloadPages:[{
    id:'detail.html',
    url:'detail.html'           
  }
  ]
});

var detailPage = null;
//添加列表项的点击事件
mui('.mui-content').on('tap', 'a', function(e) {
  var id = this.getAttribute('id');
  //获得详情页面
  if(!detailPage){
    detailPage = plus.webview.getWebviewById('detail.html');
  }
  //触发详情页面的newsId事件
  mui.fire(detailPage,'newsId',{
    id:id
  });
//打开详情页面          
  mui.openWindow({
    id:'detail.html'
  });
});  
{% endhighlight %}  

详情页面代码如下：

{% highlight javascript %}
//添加newId自定义事件监听
window.addEventListener('newsId',function(event){
  //获得事件参数
  var id = event.detail.id;
  //根据id向服务器请求新闻详情
  .....
});
{% endhighlight %}  

# utils

## 一、init()  

目前支持在`mui.init`方法中配置的功能包括：创建子页面、关闭页面、手势事件配置、预加载、下拉刷新、上拉加载、设置系统状态栏背景颜色。  

所有可配置项：  

{% highlight javascript %}
mui.init({
//子页面
	subpages: [{
		//...
	}],
//预加载
	 preloadPages:[
	    //...
 	 ],
//下拉刷新、上拉加载
 	pullRefresh : {
	   //...
     	},
//手势配置
 	 gestureConfig:{
	   //...
	},
//侧滑关闭
	swipeBack:true, //Boolean(默认false)启用右滑关闭功能
	
//监听Android手机的back、menu按键，默认监听
	keyEventBind: {
		backbutton: false,  //Boolean(默认true)关闭back按键监听
		menubutton: false   //Boolean(默认true)关闭menu按键监听
	},
//处理窗口关闭前的业务
	beforeback: function() {
		//... //窗口关闭前处理其他业务详情点击 ↑ "关闭页面"链接查看
	},
//设置状态栏颜色
	statusBarBackground: '#9defbcg', //设置状态栏颜色,仅iOS可用
	preloadLimit:5//预加载窗口数量限制(一旦超出,先进先出)默认不限制
})
{% endhighlight %}  


## 二、mui()  

mui使用css选择器获取HTML元素，返回mui对象数组。
`mui("p")`：选取所有`<p>`元素
`mui("p.title")`：选取所有包含`.title`类的`<p>`元素  

若要将mui对象转化成dom对象，可使用如下方法（类似jquery对象转成dom对象）：

{% highlight javascript %}
//obj1是mui对象
var obj1 = mui("#title");
//obj2是dom对象
var obj2 = obj1[0];  
{% endhighlight %} 

## 三、each()  

each既是一个类方法，同时也是一个对象方法，两个方法适用场景不同；换言之，你可以使用`mui.each()`去遍历数组或json对象，也可以使用`mui(selector).each()`去遍历DOM结构。  

遍历数组或json对象的示例代码：

{% highlight javascript %}
var array = [1,2,3]
mui.each(array,function(index,item){
  console.log(item*item);
}) 
{% endhighlight %} 

**代码解释：**  
1. `mui.each(obj，handler)`:`obj`可以是（`Array`||`JSONObj`），即需遍历的数组或对象；若为对象，仅遍历根节点下的key。`handler`是回调函数`Function(Integer||String index,Anything element)`,`index`为下标（从0开始）或key，`element`为当前元素。
2. 

遍历DOM结构的示例代码：  

{% highlight html %}
<div class="mui-input-group">
  <div class="mui-input-row">
    <label>字段1：</label>
    <input type="text" class="mui-input-clear" id="col1" placeholder="请输入">
  </div>
  <div class="mui-input-row">
    <label>字段2：</label>
    <input type="text" class="mui-input-clear" id="col2" placeholder="请输入">
  </div>
  <div class="mui-input-row">
    <label>字段3：</label>
    <input type="text" class="mui-input-clear" id="col3" placeholder="请输入">
  </div>
</div>
<script type="text/javascript">
	var check = true;
	mui(".mui-input-group input").each(function () {
	  //若当前input为空，则alert提醒
	  if(!this.value||trim(this.value)==""){
	    var label = this.previousElementSibling;
	    mui.alert(label.innerText+"不允许为空");
	    check = false;
	    return false;
	  }
	});
	//校验通过，继续执行业务逻辑
	if(check){
	  //.....
	}
</script>
{% endhighlight %} 

**代码解释：**  
1. `mui(selector).each(handler)`:`handler`是回调函数`Function(Integer index,Anything element)`,`index`为当前元素在匹配元素中的位置（从0开始），`element`为当前元素，可用`this`代替。

## 四、extend()  

将两个对象合并成一个，有两种使用方式：

方式一：

{% highlight javascript %}
<script type="text/javascript">
  var target = {
    company:"dcloud",
    product:{
      mui:"小巧、高效"
    }
  } 
  var obj1 = {
    city:"beijing",
    product:{
      HBuilder:"飞一样的编码"
    }
  }
  mui.extend(target,obj1);
  //输出：{"company":"dcloud","product":{"HBuilder":"飞一样的编码"},"city":"beijing"}
  console.log(JSON.stringify(target));
</script>
{% endhighlight %} 

**代码解释：**  
1. `.extend(target,object1[,objectN])`:参数依次为：要合并的目标对象，要合并的对象（可以为多个）。   
2. 因为默认仅合并对象根节点下的key、value，因此product节点下的mui被替换成了HBuilder； 

方式二：  

{% highlight javascript %}
<script type="text/javascript">
  var target = {
    company:"dcloud",
    product:{
      mui:"小巧、高效"
    }
  } 
  var obj1 = {
    city:"beijing",
    product:{
      HBuilder:"飞一样的编码"
    }
  }
  //支持深度合并
  mui.extend(true,target,obj1);
  //输出：{"company":"dcloud","product":{"mui":"小巧、高效","HBuilder":"飞一样的编码"},"city":"beijing"}
  console.log(JSON.stringify(target));
</script>
{% endhighlight %} 

**代码解释：**  
1. `.extend(deep,target,object1[,objectN])`:多了一个`deep`参数，该参数为`true`时，表示为深度合并，相同`key`下的`value`会全部保留。

## 五、later()  

`setTimeOut`函数的封装。  

示例代码：  

{% highlight javascript %}
<script type="text/javascript">
  mui.later(function () { 
    alert("11");
  },1000); 
</script>
{% endhighlight %} 

**代码解释：**  
1. `.later(func,delay[,context,data])`:参数依次为：需要延时执行的函数，延迟的毫秒数，上下文，数据。

## 六、scrollTo()  

滚动屏幕到指定的位置，该方法是对`window.scrollTo()`方法在手机端的增强实现，可设定滚动动画时间及滚动结束后的回调函数;鉴于手机屏幕大小，该方法仅可实现屏幕纵向滚动。  

示例代码：  

{% highlight javascript %}
  mui.scrollTo(0,1000);
{% endhighlight %}

**代码解释：**  
1. `.scrollTo(ypos,[,duration][,handler])`:参数依次为：窗口左上角显示的文档的y坐标，滚动时间周期，单位为毫秒，滚动结束后的回调函数。   
2. 示例代码含义为：1秒钟内滚动到页面顶部。  

## os

通过navigator.userAgent可判断当前运行环境,mui对此进行封装，通过调用`mui.os.XXX`即可，其中XXX可以为以下几种：  

1. `.plus`:返回是否在5+App（包括流应用）运行。  
2. `.stream`:返回是否为流应用。  
3. `.android`:返回是否为安卓手机。  
4. `.version`:安卓手机版本号。  
5. `.isBadAndroid`:android非Chrome环境。  
6. `.ios`:返回是否为苹果设备。  
7. `.version`:返回手机版本号。  
8. `.iphone`:返回是否为苹果手机。  
9. `.ipad`:返回是否为iPad。  
10. `.wechat`:返回是否在微信中运行。

示例代码：  

{% highlight javascript %}
if(mui.os.ios||(mui.os.android&&parseFloat(mui.os.version)<4.4)){
   //...
} 
{% endhighlight %}

# Ajax

mui框架封装了常用的Ajax函数，支持GET、POST请求方式，支持返回json、xml、html、text、script数据类型；mui提供了mui.ajax方法，并在mui.ajax方法基础上，进一步简化出最常用的mui.get()、mui.getJSON()、mui.post()三个方法。  

格式如下：  
`mui.ajax(url[,settings])`：  
`url`:请求发送的目标地址（String)；  
`settings`:key/value格式的json对象，用来配置ajax请求参数，完整参数如下。  


